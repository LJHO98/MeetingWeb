<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>대회 대진표</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <style>
        .tournament { display: flex; align-items: center; flex-wrap: wrap; }
    </style>
</head>
<body>
<form action="/match" th:object="${trnDto}">
    <input type="hidden" th:field="*{tournamentId}">
    <button>랜덤</button>
</form>

<!-- 대진표 동적 생성 -->
<div class="tournament">
    <div th:each="participant, stat : ${groupList}" class="team"
         th:data-num="${stat.index}"
         th:classappend="${stat.index < trnDto.format ? 'semifinals' : stat.index < trnDto.format + (trnDto.format / 2) ? 'final' : 'winner'}">
        <img th:src="${participant.profileImgUrl}">
        <span th:attr="data-id=${participant.groupId}, data-match=${participant.matchNumber}" th:text="${participant.name}"></span>
    </div>
</div>

<div> <!-- 경기결과 모달 -->
    <div class="ab">
        <span class="a1 resSelect"></span>
        <span class="b1 resSelect"></span>
        <div>
            <input type="hidden" id="win">
            <input type="hidden" id="matchNum">
            <input type="text" id="score">
        </div>
        <button type="button" id="resultSave">저장</button>
    </div>
</div>

<script>
    $(".team").on("click", function() {
        var aNum = $(this).data("num") + 1;
        var bNum = aNum % 2 == 0 ? aNum - 1 : aNum + 1;
        var agid = $(this).find("span").data("id");
        var aMatchNum = $(this).find("span").data("match");
        var bgid = $(".team").eq(bNum - 1).find("span").data("id");
        var bMatchNum = $(".team").eq(bNum - 1).find("span").data("match");
        var aName = $(this).find("span").text();
        var bName = $(".team").eq(bNum - 1).find("span").text();

        $(".ab .a1").data("id", agid).text(aName);
        $(".ab .b1").data("id", bgid).text(bName);
        $(".ab .a1").data("match", aMatchNum);
        $(".ab .b1").data("match", bMatchNum);
    });

    $(".resSelect").on("click", function() {
        $(this).css("color", "red");
        $("#win").val($(this).data("id"));
        $("#matchNum").val($(this).data("match"));
    });

    $("#resultSave").on("click", function() {
        var wingid = $("#win").val();
        var score = $("#score").val();
        var tid = $("input[name='tournamentId']").val();
        var matchNum = $("#matchNum").val();

        location.href = "/tournament/matchResult?wgid=" + wingid + "&tid=" + tid + "&score=" + score + "&matchNum=" + matchNum;
    });
</script>
</body>
</html>
